{% extends 'templates/erp/layout_clean.twig' %}
{% block title %}{{ parent() }} - Login{% endblock %}
{% block stylesheets %}
  {{ parent() }}

  {{ css('form.min.css') }}
  {{ css('login.min.css') }}
  {{ css('libs/jquery/plugins/observe.input/observe.input.min.css') }}
  <style>
    .ui.messagelist {
      position: relative;
      min-height: 1em;
      margin: 0 0;
      padding: 0 1em;
      font-size: 1.14285714rem;
      color: rgba(255,255,255,0.6);
      -webkit-transition: opacity .1s ease,color .1s ease,background .1s ease,-webkit-box-shadow .1s ease;
      transition: opacity .1s ease,color .1s ease,background .1s ease,-webkit-box-shadow .1s ease;
      transition: opacity .1s ease,color .1s ease,background .1s ease,box-shadow .1s ease;
      transition: opacity .1s ease,color .1s ease,background .1s ease,box-shadow .1s ease,-webkit-box-shadow .1s ease;
    }
    .ui.hidden.messagelist {
      display: none;
    }
    .ui.messagelist .header:not(.ui) {
      font-size: 1.51428571rem;
      color: rgba(255,255,255,0.9);
      padding-top: .5em;
    }
    .ui.messagelist ul.list {
      text-align: left;
      opacity: .85;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 1.5em;
      display: block;
    }
    .ui.messagelist ul.list li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    .ui.messagelist::before {
      display: inline-block;
      content: "";
      width: 100%;
      height: 1px;
      border-top: 1px solid rgba(34,36,38,.15);
      border-bottom: 1px solid rgba(255,255,255,.1);
    }
  </style>
{% endblock stylesheets %}
{% block content %}
  <div class="ui middle aligned center aligned grid">
    <div class="column">
      <form class="ui large form error" action="{{ path_for('ERP\\Reset', { 'UUID': uuid, 'Token': token }) }}" method="POST">
        <div class="ui basic segment">
          <img class="ui centered normal image"
               src="/erp/resources/logo/inverted/{{ uuid }}"
               alt="Logomarca da empresa">
          <div class="ui clearing divider"></div>

          <h2 class="ui header">
            <div class="content">
              Redefinição da senha
              <div class="sub header">
                Digite uma nova senha para que possamos alterar esta
                informação em sua conta.
              </div>
            </div>
          </h2>
          <div class="field{{ cssError('auth') }}">
            <input type="password" name="password" maxlength="25"
                   data-symbol="lock"
                   placeholder="Informe a nova senha">
          </div>
          <div class="field{{ cssError('auth') }}">
            <input type="password" name="chkpassword" maxlength="25"
                   data-symbol="lock"
                   placeholder="Confirme a nova senha">
          </div>

          {{ csrf() }}
          
          <table width="100%" cellspacing="0">
            <tbody>
              <tr>
                <td>
                  <input type="submit"
                         class="ui fluid large blue button"
                         style="margin-left: 0;"
                         value="Redefinir">
                </td>
                <td width="55px" style="text-align: right;">
                  <button type="button" class="ui large orange icon button"
                          style="margin-right: 0;"
                          data-tooltip="Retorna à página inicial do site"
                          data-position="top left"
                          onclick="location.href='{{ path_for('Home') }}';">
                    <i class="home icon"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div id="errorMessage" class="ui hidden messagelist">
          <div class="header">Atenção!</div>
          <ul class="list">
            <li>Você deve incluir tanto superior e inferior caso letras em sua senha</li>
            <li>Você precisa selecionar seu país de origem</li>
          </ul>
        </div>

        {% if hasErrors() %}
        <div class="ui error message">
          {% for error in getErrors('auth') %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}

        <input type="hidden" name="_method" value="{{ formMethod }}">
        <input type="hidden" name="uuid" value="{{ uuid }}">
        <input type="hidden" name="token" value="{{ token }}">
      </form>
    </div>
  </div>
{% endblock %}
{% block scripts %}
  {{ parent() }}

  {{ lib('jquery/plugins/password.strength.inspector/password.strength.inspector.min.js') }}
  {{ lib('jquery/plugins/observe.input/observe.input.min.js') }}
  
  {% apply minify %}
  <script>
    var
      strengthOptions = [
        'length',
        'alpha',
        'numeric',
        'special',
        'onlynumeric'
      ],
      strength = new PasswordStrengthInspector(25, strengthOptions)
    ;

    $(document).ready(function()
    {
      // -------------------------------[ Componentes do formulário ]---
      $("input[name=password]")
        .observeinput({
          enableToggleView: true,
          icon: {
            left: 'lock',
            right: 'none',
          },
          onComplete: function () {
            var
              password = $(this).val(),
              result   = strength.validate(password)
            ;
            
            if (result) {
              $("#errorMessage")
                .hide()
              ;
            } else {
              // Exibe os erros
              var
                errorList = $("#errorMessage").children("ul.list"),
                errors    = strength.getErrors()
              ;

              errorList
                .empty()
              ;
              $.each(errors, function(index, value) {
                errorList
                  .append('<li>'+value+'</li>')
                ;
              });
              $("#errorMessage")
                .show()
              ;
            }
            
            return result;
          },
        })
      ;

      $("input[name=chkpassword]")
        .observeinput({
          enableToggleView: true,
          icon: {
            left: 'lock',
            right: 'none'
          },
          onTyping: function () {
            var password = $("input[name=password]").val();
            return ($(this).val() === password)?true:false;
          },
        })
      ;
      
      // Coloca o foco no primeiro campo
      $("input[name='password']")
        .focus()
      ;
    });
  </script>
  {% endapply %}
{% endblock scripts %}
